<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <title>WS STOMP Test</title>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h3>STOMP 테스트</h3>
<div>
  <label>Room ID: <input id="roomId" value="1"/></label>
  <button onclick="connect()">Connect</button>
  <button onclick="disconnect()">Disconnect</button>
  <button onclick="subscribeRoom()">Subscribe Room</button>
</div>
<div style="margin-top:8px;">
  <input id="senderId" placeholder="senderId" value="1"/>
  <input id="receiverId" placeholder="receiverId" value="2"/>
  <input id="text" placeholder="message"/>
  <button onclick="sendMessage()">Send (/pub/chatting/send)</button>
</div>
<pre id="log" style="border:1px solid #ccc;padding:8px;height:240px;overflow:auto;"></pre>
<script>
  let stompClient = null;
  function log(msg){const el=document.getElementById('log');el.textContent+=msg+'\n';el.scrollTop=el.scrollHeight;}

  function connect(){
    const socket=new SockJS('/ws-stomp');
    stompClient=Stomp.over(socket);
    stompClient.debug=null;
    stompClient.connect({}, ()=>log('Connected'), err=>log('Error: '+err));
  }
  function disconnect(){ if(stompClient) stompClient.disconnect(()=>log('Disconnected')); }
  function subscribeRoom(){
    if(!stompClient || !stompClient.connected) return log('Not connected');
    const roomId=document.getElementById('roomId').value;
    stompClient.subscribe(`/sub/chatting/room/${roomId}`, frame=>{
      log('RECV: '+frame.body);
    });
    log('Subscribed room '+roomId);
  }
  function sendMessage(){
    if(!stompClient || !stompClient.connected) return log('Not connected');
    const body={
      roomId: Number(document.getElementById('roomId').value),
      senderId: Number(document.getElementById('senderId').value),
      receiverId: Number(document.getElementById('receiverId').value),
      text: document.getElementById('text').value
    };
    stompClient.send('/pub/chatting/send', {}, JSON.stringify(body));
    log('SEND: '+JSON.stringify(body));
  }
</script>
</body>
</html>
